;---------------------------------------------------
; Program: DETECTOR DE PALINDROMOS
; Author: GABRIEL AUREO
; Date: 06/09/2018
;---------------------------------------------------

;EU NÃO CONSEGUI FAZER A ROTINA DO CONSOLE FUNCIONAR NO PROGRAMA, POIS O MESMO NÃO ACEITAVA NENHUMA FORMA DE ENTRADA
;ESSE COMPORTAMENTO SE REPETIA ATÉ MESMO NOS EXEMPLOS DO SIMUS
;O ALGORITMO SE ENCONTRA NO CÓDIGO-FONTE, PORÉM NUNCA É CHAMADO


ORG 100
PALINDROMO: STR "Ovo"
DW 0
PALINPNTR: DW PALINDROMO

;INPUTPTR: DW 0


ORG 0
MAIN:

;LÊ ENTRADA DO CONSOLE
;ENTRADA:
;LDA #3
;TRAP 0
;JZ ENTRADA
;STA INPUTPTR

LDA PALINPNTR
PUSH
LDA PALINPNTR +1
PUSH
JSR PALINDROMOCHK

HLT
END MAIN

ORG 2000
SP: DW 0
RPTR: DW 0
LPTR: DW 0
LDIG: DB 0
RDIG: DB 0
PTRDISTANCE: DB 0

POSMSG: STR "É PALINDROMO"
DB 0
PALINMSG: DW POSMSG
NEGMSG: STR "NÃO É PALINDROMO"
DB 0
NPALINMSG: DW NEGMSG

SPC EQU 32

ORG 1000
PALINDROMOCHK:
STS SP
POP
POP
POP
STA LPTR + 1
POP
STA LPTR

LDS LPTR
STS RPTR

;EMPURRA O PONTEIRO RPTR PARA O FIM DA STRING
CONTASTRING:
  LDA @RPTR
  JZ REMOVENULL
  LDS RPTR
  POP
  STS RPTR
  JMP CONTASTRING

;COMO RPTR TERMINA APONTANDO PARA O NULL, MOVEMOS PARA A ÚLTIMA LETRA DA STRING
REMOVENULL:
  LDA RPTR
  SUB #1
  STA RPTR
  LDA RPTR + 1
  SBC #0
  STA RPTR + 1

ITERAESQ:
  LDS SP
  LDA @LPTR
  JSR ITERALADO
  STA LDIG
  SUB #SPC
  JNZ ITERADIR
  LDS LPTR
  POP
  STS LPTR
  JMP ITERAESQ

ITERADIR:
  LDS SP
  LDA @RPTR
  JSR ITERALADO
  STA RDIG
  SUB #SPC
  JNZ AVALIALADOS
  LDA RPTR
  SUB #1
  STA RPTR
  LDA RPTR +1
  SBC #0
  STA RPTR +1
  JMP ITERADIR

AVALIALADOS:
  LDA LDIG
  SUB RDIG
  JNZ NAOPALINDROMO

  LDA LPTR
  SUB RPTR
  JNZ REPEAT
  LDA LPTR + 1
  SUB RPTR + 1
  JZ EHPALINDROMO
  SUB #1
  JZ EHPALINDROMO

REPEAT:
  LDS LPTR
  POP
  STS LPTR
  LDA RPTR
  SUB #1
  STA RPTR
  LDA RPTR +1
  SBC #0
  STA RPTR +1
  JMP ITERAESQ

EHPALINDROMO:
  LDA #4
  TRAP @PALINMSG
  JMP ITERAFIM
NAOPALINDROMO:
  LDA #4
  TRAP @NPALINMSG
ITERAFIM:
LDS SP
RET

ORG 3000
SP1: DW 0
DIG: DB 0
ACENTOS: STR "ÁÀÂÃâáàâãÉÈÊéèêÍÌÎíìîÓÒÔóòôÚÙÛÜúùûü"
DW 0
SUBST: STR "aaaaaaaaeeeeeeiiiiiioooooouuuuuuuu"
DW 0
STRINDEX: DB 0
ACPOINTER: DW ACENTOS
SUBSTPOINTER: DW SUBST

AMIN EQU 061H
AMAX EQU 041H
ZMIN EQU 07AH
ZMAX EQU 05AH

ORG 4000

ITERALADO:
STS SP1
STA DIG
POP
POP

LDS #ACENTOS
STS ACPOINTER
LDS #SUBST
STS SUBSTPOINTER
LDA #0
STA STRINDEX

LDA DIG
SUB #SPC
JZ ISSPC

LDA DIG
SUB #AMIN
JN CAPSCHK
LDA #ZMIN
SUB DIG
JN CAPSCHK
LDA DIG
JMP RETURN

CAPSCHK:
LDA DIG
SUB #AMAX
JN SEARCH
LDA #ZMAX
SUB DIG
JN SEARCH
LDA DIG
ADD #020H
JMP RETURN

SEARCH:
LDA @ACPOINTER
SUB DIG
JZ FOUND

LDA STRINDEX
ADD #1
STA STRINDEX

LDS ACPOINTER
POP
STS ACPOINTER

JMP SEARCH
FOUND:
LDA SUBSTPOINTER
ADD STRINDEX
STA SUBSTPOINTER
LDA SUBSTPOINTER +1
ADC #0
STA SUBSTPOINTER +1

LDA @SUBSTPOINTER
STA DIG
LDA DIG
JMP RETURN

ISSPC:
LDA #SPC
RETURN:
LDS SP1
RET





















