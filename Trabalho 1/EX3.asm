;---------------------------------------------------
; Programa: LEITURA TECLADO
; Autor: GABRIEL AUREO
; Data: 05/09/2018
;---------------------------------------------------

ORG 100
VALOR: DW 0

ORG 0
MAIN:
  LDA #VALOR
  PUSH
  JSR LEITOR
END MAIN


ORG 300
SP: DW 0
PTR: DW 0
DIG: DB 0
SOMA: DW 0
PWR: DB 4
IDX: DB 0

ASCII EQU 030H
MINUS EQU 02AH


ORG 200

LEITOR:
  STS SP
  POP
  POP
  POP
  LDS PTR

FRSTINPUT:
  IN 3
  AND #1
  JZ FRSTINPUT
  IN 2
  XOR #MINUS
  JNZ ASCIIOFF
  LDA #0FFH
  STA SOMA+1
  LDA #3
  STA PWR

INPUT:
  IN 3
  AND #1
  JZ INPUT
  IN 2
ASCIIOFF:
  SUB #ASCII
  STA DIG
MUL10:
  LDA DIG
  PUSH
  LDA #10
  PUSH
  LDA SOMA
  PUSH
  JMP INPUT

ORG 900
MULT:
  STS SP1
  POP
  POP
  POP
  STA PTR
  POP
  STA Y
  POP
  STA X

MULTLOOP:
  LDA Y
  JZ RETURN
  AND #1
  JZ SHIFT

  LDA Z
  ADD X
  STA Z
  LDA Z+1
  ADC X+1
  STA Z+1
  JC OVERFLOW
;CASO OCORRA OVERFLOW AO INCREMENTAR O RESULTADO, OBRIGATORIAMENTE O VALOR DA MULTIPLICAÇÃO FOI ALCANÇANDO, PORTANTO A ROTINA PODE TERMINAR

SHIFT:
;DOBRA O PRIMEIRO VALOR
  LDA X
  SHL
  STA X
  LDA #0
  JNC HISHIFT
  LDA #1

HISHIFT:
  STA HIOF
  LDA X+1
  SHL
  ADD HIOF
  STA X+1

  LDA Y
  SHR
  STA Y
  JMP MULTLOOP

OVERFLOW:
  LDA #1
RETURN:
  LDS Z
  STS @PTR
  LDS SP1
  RET





