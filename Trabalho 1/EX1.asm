;---------------------------------------------------
; Programa: EX 1 - TRABALHO 1
; Autores: GABRIEL AUREO E GABRIEL RAPOSO
; Data: 02/09/2018
;---------------------------------------------------
ORG 60H
  N: DW 0
  M: DW 0
  RESULTADO: DW 0
  OP: DB 0

ORG 0

MAIN:
  LDA #OP
  PUSH
  JSR SCAN

  LDA #N
  PUSH
  JSR SCAN

  LDA #M
  PUSH
  JSR SCAN

  LDA #N ;PASSA O PRIMEIRO ARGUMENTO DE OPERADOIS ATRAVÉS DA PILHA
  PUSH
  LDA #M ;PASSA O SEGUNDO ARGUMENTO DE OPERADOIS ATRAVÉS DA PILHA
  PUSH
  LDA #RESULTADO ;PASSA O ENDEREÇO A SER CARREGADO O RESULTADO DE OPERADOIS ATRAVÉS DA PILHA
  PUSH
  LDA OP ;PASSA A OPERAÇÃO A SER REALIZADA EM OPERADOIS ATRAVÉS DO ACUMULADOR
  JSR OPERADOIS ;CHAMA A SUBROTINA OPERADOIS
  OUT 0
  LDA RESULTADO

  HLT

END

ORG 300

;VARIAVEIS SCANB

SP0: DW 0
INPUT: DW 0

ORG 500
;SUBROTINA QUE SCANEIA ENTRADA E GUARDA EM UM PONTEIRO PASSADO PELA PILHA
SCAN:
  STS SP0

  POP
  POP

  POP
  STA INPUT

INPUTLOOP:
  IN 1
  AND #1
  JZ INPUTLOOP
  IN 0
  STA @INPUT

  LDS SP0
  RET

ORG 800

SP1: DW 0
MODO: DB 0
X: DW 0
Y: DW 0
Z: DW 0


ORG 1100
OPERADOIS:

  STS SP1

  STA MODO

  POP
  POP

  POP
  STA Z

  POP
  STA Y

  POP
  STA X

  LDA MODO
  SUB #1
  JNZ ADICAO

  LDA @X
  SUB @Y
  JMP RETORNO

  ADICAO:
    LDA @X
    ADD @Y
  RETORNO:
    STA @Z
    JC OVERFLOW
    LDA #0
    JMP FINAL
    OVERFLOW:
      LDA #1
  FINAL:
  LDS SP1
  RET

